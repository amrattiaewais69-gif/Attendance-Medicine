<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance QR System</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
  body{
    height:100vh;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    display:flex;
    justify-content:center;
    align-items:center;
    color:#fff;
  }
  .container{
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(15px);
    border-radius:20px;
    padding:40px 25px;
    text-align:center;
    width:90%;
    max-width:450px;
    box-shadow:0 8px 25px rgba(0,0,0,0.3);
  }
  h1{
    font-size:28px;
    font-weight:700;
    background: linear-gradient(90deg,#00bcd4,#007bff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:10px;
  }
  h2{color:#fff;font-weight:500;margin-bottom:20px;}
  input{
    width:100%;
    padding:12px 15px;
    margin:8px 0;
    border:none;
    border-radius:12px;
    background: rgba(255,255,255,0.15);
    color:#fff;
    font-size:16px;
    transition:all 0.3s ease;
  }
  input::placeholder{color: rgba(255,255,255,0.7);}
  input:focus{outline:none;background: rgba(255,255,255,0.25); box-shadow:0 0 10px rgba(0,188,212,0.7);}
  button{
    width:100%;
    padding:14px;
    margin-top:15px;
    border:none;
    border-radius:12px;
    background: linear-gradient(90deg,#007bff,#00bcd4);
    color:#fff;
    font-size:18px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
  }
  button:hover{transform:translateY(-2px); box-shadow:0 5px 15px rgba(0,123,255,0.4);}
  #qr-reader{width:300px;height:300px;margin:20px auto;display:none;}
  .msg{margin-top:15px;font-weight:600; min-height:24px;}
  .msg.success{color:#4CAF50;}
  .msg.error{color:#ff5252;}
  .info-box{
    background: rgba(255,255,255,0.1);
    padding:12px 15px;
    border-radius:12px;
    margin-bottom:15px;
    display:none;
    text-align:left;
  }
  .info-box span{display:block;}
  .footer{
    margin-top:20px;
    font-size:14px;
    color: rgba(255,255,255,0.6);
  }
</style>
</head>
<body>

<div class="container">
  <h1>University of East Capital</h1>
  <h2>Attendance Recording System</h2>

  <div id="sessionSetup">
    <input type="text" id="lecturer" placeholder="Enter Lecturer Name" required>
    <input type="text" id="course" placeholder="Enter Course Name" required>
    <input type="text" id="group" placeholder="Enter Group" required>
    <button onclick="startSession()">Start Session</button>
  </div>

  <div class="info-box" id="sessionInfo">
    <span><strong>Lecturer:</strong> <span id="infoLecturer"></span></span>
    <span><strong>Course:</strong> <span id="infoCourse"></span></span>
    <span><strong>Group:</strong> <span id="infoGroup"></span></span>
  </div>

  <div id="qr-reader"></div>
  <div class="msg" id="msg"></div>
  <div class="footer">Designed by UEC ICT Department</div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzaUJ3bzVbi3hd9E1fkBE1LnZdjzS4le9Ik-AxHeQ9jxlltEEgWo96MJPXnJgwcyLbV/exec"; // ضع هنا رابط Google Apps Script
let lecturerName = "", courseName = "", groupName = "";
const msg = document.getElementById("msg");
const html5QrCode = new Html5Qrcode("qr-reader");

function startSession(){
  lecturerName = document.getElementById("lecturer").value.trim();
  courseName = document.getElementById("course").value.trim();
  groupName = document.getElementById("group").value.trim();

  if(!lecturerName || !courseName || !groupName){
    msg.textContent = "Enter Lecturer, Course, and Group";
    msg.className="msg error";
    return;
  }

  document.getElementById("sessionSetup").style.display="none";

  document.getElementById("infoLecturer").textContent = lecturerName;
  document.getElementById("infoCourse").textContent = courseName;
  document.getElementById("infoGroup").textContent = groupName;
  document.getElementById("sessionInfo").style.display = "block";

  document.getElementById("qr-reader").style.display="block";

  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  ).catch(err => {
    msg.textContent = "⚠️ Unable to access camera. Please allow permission.";
    msg.className="msg error";
    console.error(err);
  });
}

function onScanSuccess(decodedText){
  saveAttendance(decodedText.trim());
}

function saveAttendance(studentId){
  const data = {
    lecturer: lecturerName,
    course: courseName,
    group: groupName,
    student_id: studentId
  };

  fetch(scriptURL, {
    method:"POST",
    mode:"no-cors",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });

  msg.textContent = "Saved: " + studentId;
  msg.className="msg success";
}
</script>

</body>
</html>
